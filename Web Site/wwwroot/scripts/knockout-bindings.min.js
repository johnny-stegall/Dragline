ko.bindingHandlers.numericValue={init:function(e,i,t,r,a){ko.bindingHandlers.value.init(e,i,t)},update:function(e,i,t,r,a){var n=ko.utils.unwrapObservable(i()),l=ko.utils.unwrapObservable(t().precision)||2,s=parseFloat(n).toFixed(l);ko.bindingHandlers.value.update(e,function(){return s})}},ko.bindingHandlers.fadeVisible={init:function(e,i,t,r,a){var n=i();$(e).toggle(ko.utils.unwrapObservable(n))},update:function(e,i,t,r,a){var n=i();ko.utils.unwrapObservable(n)?$(e).fadeIn():$(e).fadeOut("fast")}},ko.bindingHandlers.formatDate={update:function(e,i,t,r,a){var n=ko.utils.unwrapObservable(i()),l=t(),s=l.dateFormat||"M/D/YYYY";$(e).text(moment(n).format(s))}},ko.bindingHandlers.slideVisible={init:function(e,i,t,r,a){var n=i();$(e).toggle(ko.utils.unwrapObservable(n))},update:function(e,i,t,r,a){var n=i();ko.utils.unwrapObservable(n)?$(e).slideDown("fast"):$(e).slideUp("fast")}},ko.bindingHandlers.log={update:function(e,i,t,r,a){var n=ko.utils.unwrapObservable(i());console.log("observable changed",n)}},ko.bindingHandlers.allowBindings={init:function(e,i,t,r,a){var n=ko.utils.unwrapObservable(i());return{controlsDescendantBindings:!n}}},ko.lazyObservable=function(e,i){var t=ko.observable(),r=!1,a=ko.dependentObservable({read:function(){return a.loaded()||r||(r=!0,e.call(i)),t()},write:function(e){r=!1,a.loaded(!0),t(e)},deferEvaluation:!0});return a.loaded=ko.observable(),a.refresh=function(){a.loaded(!1)},a},function(e,i,t){"use strict";function r(e,i){if(e.length)for(var t in i)e.attr(t,i[t]())}function a(e,i){if(e.length)for(var t in i)e.css(t,i[t]())}function n(e,i,t){if(t>i)for(var r=i;t>r;r++)e[r]=e.splice(r+1,1,e[r])[0];else if(i>t)for(var r=i;r>t;r--)e[r]=e.splice(r-1,1,e[r])[0]}function l(e){if(e&&x&&!(x.CacheExpiration<0)){0==x.CacheExpiration&&(x.CacheExpiration=k);var t={Layout:ko.mapping.toJS(e),Expiration:+new Date+1e3*(x.CacheExpiration||24)*60*60};t=JSON.stringify(t),localStorage[C+i.location]=t}}function s(e,i,t){var n;return n="select"===t.Type().toLowerCase()?$("<select />"):"textarea"===t.Type().toLowerCase()?$("<textarea />"):$("<input />").attr("type",t.Type().toLowerCase()),n.addClass("Editable").attr("id",i.attr("id").substring(2)+"-"+t.Label().replace(M,"")),t.Data&&t.Data.call(n,t),t.Styling&&a(n,t.Styling),t.Attributes&&r(n,t.Attributes),n}function o(e,i){var t=$("<i />").addClass("fa fa-close").on("click.widgets.metaform",$.proxy(f,i,this)),r=$("<li />").addClass("Form-Group").data("Metaform Field",this).append('<i class="fa fa-ellipsis-v Anchor" />').append(t);return this.Label&&r.append("<label>"+this.Label()+"</label>"),this.ContainerStyling&&a(r,this.ContainerStyling),e.append(r),r}function d(e,i){if(!e)throw new Error("No FORM element found.");if(!this)throw new Error("No metadata found.");if(!this.Title())throw new Error("The title for the FIELDSET is required.");var t=$("<ol />").attr("id","ol"+this.Title().replace(M,"")).addClass("Forms"),r=$("<i />").addClass("fa fa-chevron-up").on("click.widgets.metaform",F),n=$("<i />").addClass("fa fa-close").on("click.widgets.metaform",$.proxy(p,i,this)),l=$("<fieldset />").append("<header>"+this.Title()+"</header>").append('<i class="fa fa-ellipsis-v Anchor" />').append(r).append(n).append(t);this.Styling&&a(l,this.Styling);for(var d=0;d<this.Fields().length;d++){var f=o.call(this.Fields()[d],t,this),c=s(l,t,this.Fields()[d]);f.append(c).children("label").attr("for",c.attr("id"))}return l}function f(e,i){var t=this.Fields.indexOf(e);t>-1&&(this.Fields.splice(t,1),v($(i.target).parents("fieldset"),this))}function p(e,i){var t=this.Fieldsets.indexOf(e);t>-1&&(this.Fieldsets.splice(t,1),b($(i.target).parents("form.Metaform"),this))}function c(){var e=JSON.parse(localStorage.getItem(C+i.location))||{};return e.Expiration>=+new Date?e.Layout:null}function h(e,i){if(O=i.item.index(),!(0>E||0>O)){{i.item.parents("form.Metaform")}if(i.sender){var t=i.sender.parents("form.Metaform").children("fieldset").index(i.sender.parents("fieldset")),r=i.item.parents("form.Metaform").children("fieldset").index(i.item.parents("fieldset")),a=this.Fieldsets()[t].Fields().splice(E,1)[0];this.Fieldsets()[r].Fields().splice(O,0,a)}else{var l=i.item.parents("form.Metaform").children("fieldset").index(i.item.parents("fieldset"));n(this.Fieldsets()[l].Fields(),E,O)}E=-1,O=-1}}function u(e,i){O=i.item.parent().children("fieldset").index(i.item),n(this.Fieldsets(),E,O),E=-1,O=-1}function v(e,i){e.find("li.Form-Group").filter(function(e,t){for(var r=0;r<i.Fields().length;r++){var a=$(t).parent().attr("id").substr(2)+"-"+i.Fields()[r].Label().replace(M,"");if($(t).find("#"+a).length)return!1}return!0}).remove()}function b(e,i){e.children("fieldset").filter(function(e,t){for(var r=0;r<i.Fieldsets().length;r++){var a="ol"+i.Fieldsets()[r].Title().replace(M,"");if($(t).children("ol").attr("id")===a)return!1}return!0}).remove()}function m(e){var i=e.find("ol.Forms");this.EditMode()&&!i.hasClass("Movable")?(e.children("fieldset").addClass("Movable"),i.addClass("Movable").sortable({connectWith:"ol.Forms",handle:"i.fa-ellipsis-v",placeholder:"Form-Group Sortable-Placeholder",receive:$.proxy(h,this),start:function(e,i){E=i.item.index()},stop:$.proxy(h,this)}).disableSelection(),e.sortable({handle:"i.fa-ellipsis-v",start:function(e,i){E=i.item.parent().children("fieldset").index(i.item)},stop:$.proxy(u,this)}).disableSelection()):!this.EditMode()&&i.hasClass("Movable")&&(e.sortable("destroy"),e.children("fieldset").removeClass("Movable"),i.removeClass("Movable").sortable("destroy"))}function g(e){var i=e.find("input").add("select").add("textarea").filter(function(e,i){return!$(this).val()});this.DisplayEmpty()&&!i.is(":visible")?i.parents("li.Form-Group").show():!this.DisplayEmpty()&&i.is(":visible")&&i.parents("li.Form-Group").hide()}function F(){var e=$(this),i=e.parent();"30px"===i.css("height")?(i.animate({height:i.data("Height"),overflow:"auto",padding:"10px"}).find("li.Form-Group").css("visibility","visible"),e.removeClass("fa-chevron-down").addClass("fa-chevron-up")):(i.data("Height",i.css("height")).animate({height:"30px",overflow:"hidden",padding:"0"}).find("li.Form-Group").css("visibility","hidden"),e.removeClass("fa-chevron-up").addClass("fa-chevron-down"))}function w(e){var i=e.children("ol.Forms");v(e,this);for(var t=0;t<this.Fields().length;t++){var r=this.Title().replace(M,"")+"-"+this.Fields()[t].Label().replace(M,""),a=e.find("#"+r).parents("li.Form-Group");if(a.length)a.index()!==t&&a.insertBefore(e.find("ol.Forms > li:eq("+t+")"));else{var n=o.call(this.Fields()[t],i,this),l=s(e,i,this.Fields()[t]);n.append(l).insertBefore(e.children("li:eq("+t+")")).children("label").attr("for",l.attr("id"))}}}function y(e){if(!this.Fieldsets())return void e.children("fieldset").remove();b(e,this);for(var i=0;i<this.Fieldsets().length;i++){var t="ol"+this.Fieldsets()[i].Title().replace(M,""),r=e.find("fieldset > ol[id='"+t+"']").parent();if(r.length)r.index()!==i&&(w.call(this.Fieldsets()[i],r),r.insertBefore(e.children("fieldset:eq("+i+")")));else{var a=d.call(this.Fieldsets()[i],e,this);e.children("fieldset").length>i?a.insertBefore(e.children("fieldset:eq("+i+")")):e.append(a)}}}var x,k=8760,C="Metaform: ",M=/[^A-Za-z0-9]+/,E=-1,O=-1;ko.bindingHandlers.metaform={init:function(i,t,r,a,n){if(!e.jQuery)throw new Error("jQuery is required.");if(!jQuery.ui.sortable)throw new Error("The jQuery UI Sortable component is required.");if(!ko.mapping)throw new Error("The Knockout Mapping plugin is required.");var l=t();x=l.Options,i.jquery||(i=$(i)),i.addClass("Metaform")},update:function(e,i,t,r,a){var n=i();!n.Model&&x&&"undefined"!=typeof x.CacheExpiration&&(n.Model=ko.mapping.fromJS(c())),n.Model&&"object"==typeof n.Model&&(l(n.Model),e.jquery||(e=$(e)),y.call(n.Model,e),m.call(n.Model,e),g.call(n.Model,e))}}}(window,document);